<html>
    <head>
        <meta charset="utf8"/>
    </head>
    <body>
        <script type="text/javascript">
            window.web = {
                __callback: {},

                showSth() {
                    web.call("web","show",["aa","bb","cc"]);
                },

                invokeCallback: function(cbID,removeAfterExecute) {
                    var args = Array.prototype.slice.call(arguments);
                    args.shift();
                    args.shift();
                    for (var i = 0, length = args.length; i < length; i++ ) {
                        args[i] = decodeURIComponent(args[i]);
                    }

                    var cb = web.__callback(cbID);
                    if (removeAfterExecute) {
                        web.__callback[cbID] = undefined;
                    }
                    return cb.apply(null,args);
                },

                call: function(obj,functionName,args) {
                    var formattedArgs = [];
                    for (var i = 0,length = args.length; i < length; i++) {
                        if (typeof args[i] == "function") {
                            formattedArgs.push("f");
                            var obID = "__cb" + (+new Date);
                            web.__callback[obID] = args[i];
                            formattedArgs.push[obID];
                        } else {
                            formattedArgs.push("s");
                            formattedArgs.push(encodeURIComponent(args[i]));
                        }
                    }
                    var argStr = (formattedArgs.length > 0) ? ":" + encodeURIComponent(formattedArgs.join(":")) : "";
                    var iframe = document.createElement("IFRAME");
                    iframe.style.display = 'none';
                    var src = "snh_web://" + obj + ":" + encodeURIComponent(functionName) + argStr;
                    src = "snh_web://web/show?value=1234"
                    iframe.src = src;
                    // iframe.setAttribute("src","snh_web://" + obj + ":" + encodeURIComponent(functionName) + argStr);
                    document.documentElement.appendChild(iframe);
                    iframe.parentNode.removeChild(iframe);
                    iframe = null;
                    
                    var ret = web.retValue;
                    web.retValue = undefined;

                    if (ret) {
                        return decodeURIComponent(ret);
                    }
                },
                inject: function(obj,methods) {
                    window[obj] = {};
                    var jsObj = window[obj];
                    for (var i = 0, length = methods.length; i < length; i++) {
                        (function() {
                            var method = methods[i];
                            var jsMethod = method.replace(new RegExp(":","g"),"");
                            jsObj[jsMethod] = function() {
                                return web.call(obj,method,Array.prototype.slice.call(arguments))
                            }
                        })()
                    }
                }
            }

            function trimAllSpace(str) {
                if (typeof str == "string") {
                    return str.replace(/\s/g,'');
                }
                return str;
            }

            function test() {
                console.log(trimAllSpace("a a a   b"));
                console.log("12332")
            }

            function invokeHybrid() {
                console.log("hello world")
                window.web.showSth();
            }

            function getLogContainer() {
                var box = document.createElement('div'),
                    style = box.style;

                box.className = 'console-log';
                style.cssText = 'position:fixed; top:0; left:0; width:100%; max-height:120px; box-sizing:border-box; font:12px Courier New; color:#fff; background-color:rgba(0,0,0,0.7); word-wrap:break-word; word-break:break-all; overflow-y:scroll; padding:5px 5px; z-index = 1e6;';

                box.innerHTML = '<p style="margin:0 10px;padding:0;text-align: right"><button class="j_reload" style="color:#eee; background: #333;border:0;">刷新</button><button class="j_clear" style="color:#eee; background: #333;border:0; margin-left:5px;">清空</button></p><div></div>';
                document.documentElement.appendChild(box);

                var log = box.querySelector('div');

                box.querySelector('button.j_reload').addEventListener('click', function (e) {
                    location.reload();
                });
                box.querySelector('button.j_clear').addEventListener('click', function (e) {
                    log.innerHTML = '';
                    curLogCount = 0;
                }, false);

                return log;
            }

            (function(){
                var console = window.console || {};
                var oldLog = console.log;
                var maxLogCount = 100;
                var curLogCount = 0;
                console.log = function () {
                    var args = [].slice.call(arguments);
                    oldLog && oldLog.apply(console, args);

                    var msg = '';
                    for (var i = 0, obj, len = args.length; i < len; i++) {
                        obj = args[i];

                        try {
                            obj = JSON.stringify(obj);
                        } catch (e) {}

                        if (typeof obj === 'string') {
                            obj = obj.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                        }

                        if (i == 0) msg = obj;else msg += ', ' + obj;
                    }

                    var logContainer = this._logContainer || (this._logContainer = getLogContainer());

                    curLogCount += 1;
                    if (curLogCount < maxLogCount) {
                        logContainer.innerHTML += '&gt; ' + msg + '<br/>';
                    } else {
                        curLogCount = 0;
                        logContainer.innerHTML = '&gt; ' + msg + '<br/>';
                    }
                    logContainer.scrollTop = logContainer.scrollHeight - logContainer.clientHeight;
                }
            })()
        </script>
        <button onclick="invokeHybrid()">测试Hybrid</button>
    </body>
</html>